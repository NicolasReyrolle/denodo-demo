CREATE OR REPLACE VIEW fv_fact_immatriculations FOLDER = '/05 - final views' AS SELECT dv_immatriculations_incremental.period AS period, dv_immatriculations_incremental.codcar AS codcar, dv_immatriculations_incremental.libcar AS libcar, dv_immatriculations_incremental.cateu AS cateu, dv_immatriculations_incremental.brand_code AS brand_code, dv_immatriculations_incremental.brand_name AS brand_name, dv_immatriculations_incremental.typcom AS typcom, dv_immatriculations_incremental.mvid AS mvid, dv_immatriculations_incremental.i4x4 AS i4x4, dv_immatriculations_incremental.lon AS lon, dv_immatriculations_incremental.lar AS lar, dv_immatriculations_incremental.hau AS hau, dv_immatriculations_incremental.essim AS essim, dv_immatriculations_incremental.nbrcyl AS nbrcyl, dv_immatriculations_incremental.pkw AS pkw, dv_immatriculations_incremental.cyd AS cyd, dv_immatriculations_incremental.infco2 AS infco2, dv_immatriculations_incremental.l100km AS l100km, dv_immatriculations_incremental.infparticule AS infparticule, dv_immatriculations_incremental.infnox AS infnox, dv_immatriculations_incremental.eunorm AS eunorm, dv_immatriculations_incremental.libcrb AS libcrb, dv_immatriculations_incremental.catstc AS catstc, dv_immatriculations_incremental.datcirprm AS datcirprm, dv_immatriculations_incremental.datcir_gd AS datcir_gd, dv_immatriculations_incremental.infouti AS infouti, dv_immatriculations_incremental.induti AS induti, dv_immatriculations_incremental.codeop AS codeop, dv_immatriculations_incremental.model_id AS model_id, bv_fuel_mapping.french_label AS fuel_type, case bv_code_operation.operation_type WHEN 'Input' THEN 1 WHEN 'Output' THEN -1 ELSE 0 END AS number, bv_code_operation.french_label AS operation_name, bv_code_operation.operation_type AS operation_type, (getyear(dv_immatriculations_incremental.datcirprm)||leftpad(cast(getmonth(dv_immatriculations_incremental.datcirprm) AS VARCHAR(2)), 2, '0')) AS first_registration_period, dv_immatriculations_incremental.paypvn AS paypvn, dv_immatriculations_incremental.dathorcir AS dathorcir, dv_immatriculations_incremental.codcrb AS codcrb FROM (dv_immatriculations_incremental AS dv_immatriculations_incremental LEFT OUTER JOIN bv_code_operation AS bv_code_operation ON dv_immatriculations_incremental.codeop = bv_code_operation.code_operation ) LEFT OUTER JOIN bv_fuel_mapping AS bv_fuel_mapping ON dv_immatriculations_incremental.codcrb = bv_fuel_mapping.codcrb ;

ALTER VIEW fv_fact_immatriculations
 LAYOUT (dv_immatriculations_incremental = [130, 30, 200, 225], bv_code_operation = [541, 373, 200, 106], bv_fuel_mapping = [621, 97, 200, 105]);

